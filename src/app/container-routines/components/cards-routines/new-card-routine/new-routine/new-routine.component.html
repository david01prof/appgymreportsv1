<form [formGroup]="forms" (ngSubmit)="onSubmit()">
  <!-- Favourite Item -->
  <i class="pi pi-bookmark-fill favouriteItem" [ngClass]="show()">
    <i class="pi pi-star-fill"></i
  ></i>

  <!-- title -->
  <div class="flex justify-content-center">
    <input type="text" pInputText formControlName="titleRoutine"/>
  </div>
  <p-divider></p-divider>

  <!-- Num Exercises -->
  <div class="flex flex-column gap-2 my-2 overflow-hidden">
    <label for="username">N de ejercicios: </label>
    <p-inputNumber
      inputId="integeronly"
      formControlName="numExercises"
      (onKeyDown)="generateControlsExercises()"
      [showButtons]="true"
      (onInput)="generateControlsExercises()"
    />
  </div>

  <p-divider />

  <div class="card">
    <p-scrollPanel [style]="{ width: '100%', height: '250px', padding: '5px' }">
      @if (forms.value.numExercises != undefined && forms.value.numExercises >
      0) {

      <div formArrayName="exercises">
        <div
          *ngFor="let exercise of exercises.controls; let i = index"
          [formGroupName]="i"
        >
          <div class="mb-3">
            <div class="flex flex-column gap-2">
              <ul for="username" class="p-0 pl-3 m-0">
                <li>Ejercicio {{ i + 1 }}:</li>
              </ul>
              <div class="flex flex-column gap-2">
                <label for="username">Titulo del ejercicio</label>
                <input
                  pInputText
                  id="username"
                  aria-describedby="username-help"
                  formControlName="titleExercise"
                />
              </div>
            </div>
          </div>

          <!-- Num Series -->
          <div class="flex flex-column gap-2 my-2 overflow-hidden">
            <label for="username">N de series:</label>
            <p-inputNumber
              inputId="integeronly"
              (onKeyDown)="generateControlsSeries(i)"
              formControlName="numSeries"
              [showButtons]="true"
              (onInput)="generateControlsSeries(i)"
            />
          </div>

          <p-divider />

          @if (forms.value.exercises[i].series != undefined &&
          forms.value.exercises[i].series != 0) {

          <!-- Series -->
          <div formArrayName="series" class="pr-1">
            <div
              *ngFor="
                let member of getSeries(i).controls;
                let memberIndex = index
              "
              [formGroupName]="memberIndex"
            >
              <label class="mt-2">Serie {{ memberIndex + 1 }}:</label>

              <div class="flex justify-content-around overflow-hidden mb-1">
                <div class="flex flex-column gap-2 my-2 ml-2 overflow-hidden">
                  <label>Repeticiones:</label>
                  <p-inputNumber
                    inputId="integeronly"
                    formControlName="replays"
                    styleClass="input-styling"
                    [showButtons]="true"
                  />
                </div>

                <div class="flex flex-column gap-2 my-2 overflow-hidden mb-1">
                  <label>Peso (kg)</label>
                  <p-inputNumber
                    inputId="integeronly"
                    formControlName="weight"
                    styleClass="input-stylingWeight"
                    [showButtons]="true"
                  />
                </div>
              </div>
            </div>
          </div>
          } @if (forms.value.exercises[i].numSeries > 0) {<p-divider />}
        </div>
      </div>
      }

      <div class="flex justify-content-between">
        <div class="card flex justify-content-left">
          <div class="flex flex-column gap-2">
            <label for="tag">Tag</label>
            <input
              pInputText
              id="tag"
              aria-describedby="username-help"
              formControlName="tag"
              class="input-stylingTitleTag"
            />
          </div>
        </div>
        <div class="card flex justify-content-left mr-1">
          <div class="flex flex-column">
            <label for="tag">Color</label>
            <p-dropdown
              [options]="colorsTag"
              formControlName="severityTag"
              optionLabel="name"
              placeholder="Color Tag"
              [(ngModel)]="selectedOption"
              styleClass="w-8rem classDropdown"
            />
          </div>
        </div>
      </div>

      <div class="flex justify-content-left mt-1">
        <p-tag
          value="{{ forms.value.tag }}"
          [severity]="forms.value.severityTag.code"
        ></p-tag>
      </div>
      <!-- Comments -->
      <div class="my-3 gap-2">
        <label id="address2">Comentarios</label> <br />
        <textarea
          pInputTextarea
          aria-labelledby="address2"
          formControlName="comments"
          rows="5"
          cols="30"
          pInputTextarea
          [autoResize]="true"
          class="mt-2"
        ></textarea>
      </div>

      <div class="flex mb-2">
        <label class="w-6 text-center">Anadir a Favoritos:</label>
        <div class="card flex justify-content-center w-6">
          <p-checkbox
            formControlName="favourite"
            [binary]="true"
            inputId="binary"
            (ngModelChange)="show()"
          />
        </div>
      </div>

      <!-- Submit -->
      <div class="flex justify-content-center mt-4">
        <p-button
          type="submit"
          label="Crear"
          [disabled]="forms.invalid"
          class="mr-3"
        />
        <p-button
          label="Salir"
          severity="secondary"
          (onClick)="sendSubmitValue.emit(false)"
        />
      </div>
    </p-scrollPanel>
  </div>
</form>
